<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Shared Property</title>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:#f3f6fb;
      color:#0f172a;
    }
    .wrap{max-width:720px;margin:0 auto;min-height:100vh;padding:12px}
    .card{
      background:#fff;
      border-radius:16px;
      padding:10px;
      box-shadow:0 8px 22px rgba(0,0,0,.08);
    }
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    .pill{
      padding:6px 10px;border-radius:999px;
      background:#eff6ff;color:#1d4ed8;font-weight:800;font-size:12px
    }
    h1{
      font-size:20px;
      margin:6px 0 10px 0;
      text-transform:capitalize;
      line-height:1.25;
    }
    .meta{
      font-size:15px;
      opacity:.95;
      margin-bottom:12px;
    }
    .sec{margin-top:14px}
    .sec h2{
      font-size:15px;
      margin-bottom:8px;
    }
    #summary{
      font-size:14px;
      line-height:1.55;
      white-space:pre-wrap;
      background:#f8fafc;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:10px 12px;
    }
    .imgGrid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:8px;
    }
    .imgGrid img{
      width:100%;
      height:92px;
      border-radius:12px;
      object-fit:cover;
      border:1px solid #e5e7eb;
      cursor:pointer;
    }
    .attList{display:flex;flex-direction:column;gap:10px}
    .att{
      display:flex;align-items:center;gap:10px;
      padding:10px;border-radius:14px;border:1px solid #e5e7eb;
      background:#fff;
    }
    .att .name{
      font-weight:800;
      font-size:14px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:55vw;
    }
    .att a{
      margin-left:auto;
      background:#1d4ed8;color:#fff;
      padding:9px 12px;border-radius:12px;
      font-size:13px;text-decoration:none;font-weight:900
    }

    /* Fullscreen image viewer */
    .viewer{
      position:fixed; inset:0; z-index:99999;
      background:rgba(0,0,0,.85);
      display:none;
      place-items:center;
      padding:12px;
    }
    .viewer img{
      max-width:100%;
      max-height:88vh;
      border-radius:14px;
      box-shadow:0 18px 55px rgba(0,0,0,.35);
    }
    .viewerClose{
      position:fixed; top:14px; right:14px;
      background:#fff;
      border:0;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
    }

    .empty{
      opacity:.65;
      font-size:13px;
      padding:6px 0;
    }
	
	.ad-placeholder{
	  border: 1px dashed #cbd5e1;
	  border-radius: 14px;
	  padding: 14px;
	  background: #f8fafc;
	}
	.ad-badge{
	  display:inline-block;
	  padding:4px 8px;
	  border-radius:999px;
	  font-weight:900;
	  font-size:12px;
	  background:#111827;
	  color:#fff;
	  margin-bottom:8px;
	}
	.ad-title{font-weight:900;font-size:14px;margin-bottom:4px;}
	.ad-desc{opacity:.75;font-size:13px;line-height:1.35;}
		
  </style>
</head>

<body>
  <div class="wrap">
    <main class="card">
      <div class="row">
        <div class="pill" id="typePill" style="display:none;"></div>
        <div class="pill" id="catPill" style="display:none;"></div>
      </div>

      <h1 id="title"></h1>

      <div class="meta">
        <div><strong>Area:</strong> <span id="area"></span></div>
        <div id="sharedByRow" style="display:none;margin-top:6px;">
          <strong>Shared By:</strong>
          <span id="sharedBy"></span>
        </div>
      </div>


      <section class="sec">
        <h2>Summary</h2>
        <div id="summary"></div>
      </section>

      <section class="sec" id="imgSec">
        <h2>Images</h2>
        <div class="imgGrid" id="imgGrid"></div>
        <div class="empty" id="imgEmpty" style="display:none;">No images.</div>
      </section>

      <section class="sec" id="attSec">
        <h2>Attachments</h2>
        <div class="attList" id="attList"></div>
        <div class="empty" id="attEmpty" style="display:none;">No files.</div>
      </section>
    </main>

    <!-- ✅ Ad section BELOW the card (not inside it) -->
    <section class="sec" id="adSec">
      <h2>Sponsored</h2>
      <div class="ad-placeholder">
        <div class="ad-badge">Ad</div>
        <div class="ad-title">Test Banner</div>
        <div class="ad-desc">This is a placeholder for your web ad banner.</div>
      </div>
    </section>

  </div>


  <!-- Fullscreen image viewer -->
  <div class="viewer" id="viewer">
    <button class="viewerClose" id="viewerClose">✕</button>
    <img id="viewerImg" src="" alt="preview"/>
  </div>

<script>
  function qs(k){ return new URLSearchParams(location.search).get(k); }

<!--   function decodePayload(encoded){
    try{
      const raw = atob(encoded);
      const json = decodeURIComponent(raw);
      return JSON.parse(json);
    }catch(e){
      return null;
    }
  } -->

function decodePayload(encoded){
  try{
    const keyStrUriSafe = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";
    const baseReverseDic = {};

    function getBaseValue(alphabet, character) {
      if (!baseReverseDic[alphabet]) {
        baseReverseDic[alphabet] = {};
        for (let i = 0; i < alphabet.length; i++) baseReverseDic[alphabet][alphabet.charAt(i)] = i;
      }
      return baseReverseDic[alphabet][character];
    }

    function decompress(length, resetValue, getNextValue) {
      const dictionary = [];
      let next;
      let enlargeIn = 4;
      let dictSize = 4;
      let numBits = 3;
      let entry = "";
      const result = [];
      let i;
      let w;
      let bits, resb, maxpower, power;
      let c;
      const data = { val: getNextValue(0), position: resetValue, index: 1 };

      for (i = 0; i < 3; i += 1) dictionary[i] = i;

      bits = 0; maxpower = Math.pow(2, 2); power = 1;
      while (power != maxpower) {
        resb = data.val & data.position;
        data.position >>= 1;
        if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
        bits |= (resb > 0 ? 1 : 0) * power;
        power <<= 1;
      }

      switch (next = bits) {
        case 0:
          bits = 0; maxpower = Math.pow(2, 8); power = 1;
          while (power != maxpower) {
            resb = data.val & data.position;
            data.position >>= 1;
            if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
            bits |= (resb > 0 ? 1 : 0) * power;
            power <<= 1;
          }
          c = String.fromCharCode(bits);
          break;
        case 1:
          bits = 0; maxpower = Math.pow(2, 16); power = 1;
          while (power != maxpower) {
            resb = data.val & data.position;
            data.position >>= 1;
            if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
            bits |= (resb > 0 ? 1 : 0) * power;
            power <<= 1;
          }
          c = String.fromCharCode(bits);
          break;
        case 2:
          return "";
      }

      dictionary[3] = c;
      w = c;
      result.push(c);

      while (true) {
        if (data.index > length) return "";

        bits = 0; maxpower = Math.pow(2, numBits); power = 1;
        while (power != maxpower) {
          resb = data.val & data.position;
          data.position >>= 1;
          if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
          bits |= (resb > 0 ? 1 : 0) * power;
          power <<= 1;
        }

        switch (c = bits) {
          case 0:
            bits = 0; maxpower = Math.pow(2, 8); power = 1;
            while (power != maxpower) {
              resb = data.val & data.position;
              data.position >>= 1;
              if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
              bits |= (resb > 0 ? 1 : 0) * power;
              power <<= 1;
            }
            dictionary[dictSize++] = String.fromCharCode(bits);
            c = dictSize - 1;
            enlargeIn--;
            break;

          case 1:
            bits = 0; maxpower = Math.pow(2, 16); power = 1;
            while (power != maxpower) {
              resb = data.val & data.position;
              data.position >>= 1;
              if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
              bits |= (resb > 0 ? 1 : 0) * power;
              power <<= 1;
            }
            dictionary[dictSize++] = String.fromCharCode(bits);
            c = dictSize - 1;
            enlargeIn--;
            break;

          case 2:
            return result.join('');
        }

        if (enlargeIn == 0) { enlargeIn = Math.pow(2, numBits); numBits++; }

        if (dictionary[c]) entry = dictionary[c];
        else if (c === dictSize) entry = w + w.charAt(0);
        else return null;

        result.push(entry);

        dictionary[dictSize++] = w + entry.charAt(0);
        enlargeIn--;

        w = entry;

        if (enlargeIn == 0) { enlargeIn = Math.pow(2, numBits); numBits++; }
      }
    }

    const json = decompress(encoded.length, 32, index => getBaseValue(keyStrUriSafe, encoded.charAt(index)));
    return json ? JSON.parse(json) : null;

  }catch(e){
    return null;
  }
}


  function escapeHtml(s){
    return String(s||'')
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#039;");
  }

  function safeText(v){ return String(v||'').trim(); }

  (function init(){
    const d = qs('d');
    const payload = d ? decodePayload(d) : null;

    if (!payload){
      document.body.innerHTML = "<div style='padding:18px;font-weight:900;font-family:system-ui'>Invalid share link.</div>";
      return;
    }

    // Basic data
    // Basic data
    document.getElementById('title').textContent = safeText(payload.title);
    document.getElementById('area').textContent  = safeText(payload.area);
    document.getElementById('summary').textContent = safeText(payload.summary);

    // Shared By
    const sb = safeText(payload.shared_by);
    const sc = safeText(payload.shared_contact);
    const sharedByRow = document.getElementById('sharedByRow');
    const sharedBy = document.getElementById('sharedBy');

    if ((sb || sc) && sharedByRow && sharedBy) {
      sharedByRow.style.display = "block";
      sharedBy.textContent = sb && sc ? `${sb} - ${sc}` : (sb || sc);
    }


    // pills
    const type = safeText(payload.type);
    const cat  = safeText(payload.category);

    const typePill = document.getElementById('typePill');
    const catPill  = document.getElementById('catPill');

    if (type) { typePill.textContent = type; typePill.style.display = "inline-flex"; }
    if (cat)  { catPill.textContent  = cat;  catPill.style.display  = "inline-flex"; }

    // Images (gallery)
    const imgs = Array.isArray(payload.images) ? payload.images : [];
    const imgSec = document.getElementById('imgSec');
    const imgGrid = document.getElementById('imgGrid');
    const imgEmpty = document.getElementById('imgEmpty');

    if (!imgs.length){
      imgGrid.innerHTML = "";
      imgEmpty.style.display = "block";
    } else {
      imgGrid.innerHTML = imgs.map(src => `<img src="${escapeHtml(src)}" data-src="${escapeHtml(src)}" alt="image">`).join('');
    }

    // Attachments (Open button only - no src text)
    const atts = Array.isArray(payload.attachments) ? payload.attachments : [];
    const attList = document.getElementById('attList');
    const attEmpty = document.getElementById('attEmpty');

    if (!atts.length){
      attList.innerHTML = "";
      attEmpty.style.display = "block";
    } else {
      attList.innerHTML = atts.map((a, idx) => {
        const name = escapeHtml(a?.name || ("Attachment " + (idx+1)));
        const src  = escapeHtml(a?.src || "");
        return `
          <div class="att">
            <div class="name">${name}</div>
            <a href="${src}" target="_blank" rel="noopener">Open</a>
          </div>
        `;
      }).join('');
    }

    // Fullscreen image viewer
    const viewer = document.getElementById('viewer');
    const viewerImg = document.getElementById('viewerImg');
    const viewerClose = document.getElementById('viewerClose');

    imgGrid.addEventListener('click', (e) => {
      const t = e.target;
      if (!t || t.tagName !== "IMG") return;
      const src = t.getAttribute("data-src") || t.getAttribute("src");
      if (!src) return;
      viewerImg.src = src;
      viewer.style.display = "grid";
    });

    function closeViewer(){
      viewer.style.display = "none";
      viewerImg.src = "";
    }

    viewerClose.addEventListener('click', closeViewer);
    viewer.addEventListener('click', (e) => {
      if (e.target === viewer) closeViewer();
    });

  })();
</script>

</body>
</html>
